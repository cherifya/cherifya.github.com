Kiosque=SC.Application.create({store:SC.Store.create().from("Kiosque.FeedsDataSource")});SC.ready(function(){});Kiosque.main=function main(){Kiosque.getPath("mainPage.mainPane").append();Kiosque.statechart.initStatechart();SC.LOG_TOUCH_EVENTS=NO};Kiosque.initData=function(){Kiosque.feedsController.loadFeeds();Kiosque.articlesController.loadArticles()};function main(){Kiosque.main()}SC.ExceptionHandler.handleException=function(a){SC.Logger.debug("Exception: %@".fmt(a.message));return YES};if(typeof CHANCE_SLICES==="undefined"){var CHANCE_SLICES=[]}CHANCE_SLICES=CHANCE_SLICES.concat([]);Kiosque.articleController=SC.ObjectController.create({content:null});Kiosque.articlesController=SC.ArrayController.create({content:null,selection:null,loadArticles:function(){var b,a=this.get("content");if(SC.none(a)){b=SC.Query.local(Kiosque.Article,{orderBy:"publishedDate DESC"});a=Kiosque.store.find(b);Kiosque.articlesController.set("content",a)}else{a.refresh()}},loadArticlesFromSource:function(d){var c,b,a=this.get("content");b=Kiosque.store.find(Kiosque.Feed,d.get("url"));this.set("content",b.get("articles"))},selectionDidChange:function(){var a=this.get("selection");if(a&&a.get("length")>0){var b=a.firstObject();Kiosque.statechart.sendEvent("openArticle",b)}}.observes("selection")});Kiosque.feedsController=SC.ArrayController.create({loadingData:NO,feedUrls:"http://feeds.arstechnica.com/arstechnica/index".w(),sourcesBinding:"Kiosque.sourcesController.content",maxEntriesPerFeed:45,selection:null,loadFeeds:function(){this.set("loadingData",YES);var b=this,a=this.get("content");var c=this.get("sources");if(SC.none(c)){return}if(SC.none(a)){var d=SC.Query.local(Kiosque.Feed,{feedUrls:c.getEach("url"),maxEntriesPerFeed:this.get("maxEntriesPerFeed"),queryLoaded:NO,queryLoadedDidChange:function(){var e=this.get("queryLoaded");if(e){b.set("loadingData",NO)}}.observes("queryLoaded")});a=Kiosque.store.find(d);this.set("content",a)}else{a.refresh()}},loadingDataDidChange:function(){var a=this.get("loadingData");if(!a){this.invokeLater("hideSpinner",3000)}else{Kiosque.statechart.sendEvent("showSpinner")}}.observes("loadingData"),hideSpinner:function(){Kiosque.statechart.sendEvent("hideSpinner")}});Kiosque.preferencesController=SC.ObjectController.create({feeds:function(a,c){var b=this.readPreference("feeds");if(SC.none(b)||(b.get("length")===0)){this.addFeed([{name:"Tuaw",url:"http://www.tuaw.com/rss.xml"}]);b=this.readPreference("feeds")}return b}.property(),addFeed:function(a){if(SC.none(a)){return}if(SC.typeOf(a)!==SC.T_ARRAY){a=[a]}var c=this.readPreference("feeds");if(SC.none(c)){c=[]}for(var b=0;b<a.get("length");b++){var d=a[b];c.push(d)}this.setPreference("feeds",c)},removeFeed:function(e){if(SC.none(e)){return}var c=this.readPreference("feeds");if(SC.none(c)){return}var a,b,d;for(a=0;a<c.length;a++){b=c[a];if(b.name===e.name&&b.url===e.url){d=b;break}}if(!SC.none(d)){c.removeObject(d)}this.setPreference("feeds",c)},resetFeeds:function(){resetCookie("feeds")},setPreference:function(a,b){createCookie(a,serializeJSObject(b),60)},readPreference:function(prefName){var prefValue=readCookie(prefName);prefValue=eval(prefValue);return prefValue}});function createCookie(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"}function readCookie(d){var f=d+"=";var a=document.cookie.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1,g.length)}if(g.indexOf(f)===0){var b=g.substring(f.length,g.length);return b}}return null}function resetCookie(a){createCookie(a,"",-1)}function serializeJSObject(e){if(e===null){return"null"}switch(typeof e){case"number":case"boolean":case"function":return e;case"string":return"'"+e+"'";case"object":var d;if(e.constructor===Array||typeof e.callee!=="undefined"){d="[";var c,a=e.length;if(a===0){return"[]"}for(c=0;c<a-1;c++){d+=serializeJSObject(e[c])+","}d+=serializeJSObject(e[c])+"]"}else{d="{";var b;for(b in e){d+=b+":"+serializeJSObject(e[b])+","}d=d.replace(/\,$/,"")+"}"}return d;default:return"UNKNOWN"}}Kiosque.settingsViewController=SC.ObjectController.create({showNewFeedSection:function(b){var a=b.parentView.parentView;a.buttonsSection.set("isVisible",NO);a.newFeedSection.set("isVisible",YES)},hideNewFeedSection:function(b){var a=b.parentView.parentView;if(SC.none(a)){a=b}a.buttonsSection.set("isVisible",YES);a.newFeedSection.set("isVisible",NO)},deleteFeed:function(c){var b=c.parentView.parentView;var a=b.scroll.contentView;a.deleteSelection()}});Kiosque.sourcesController=SC.ArrayController.create(SC.CollectionViewDelegate,{loadingData:NO,selection:null,loadSources:function(){this.set("loadingData",YES);var b=this,a=this.get("content");if(SC.none(a)){var c=SC.Query.local(Kiosque.RssSource,{orderBy:"name",isEditable:YES,queryLoaded:NO,queryLoadedDidChange:function(){var d=this.get("queryLoaded");if(d){b.set("loadingData",NO)}}.observes("queryLoaded")});a=Kiosque.store.find(c);this.set("content",a)}else{a.refresh()}},selectionDidChange:function(){var a=this.get("selection");if(a&&a.get("length")>0){var b=a.firstObject();SC.Logger.debug("source: %@".fmt(b.get("name")));Kiosque.statechart.sendEvent("filterSource",b)}}.observes("selection"),showPickerPane:function(a){var b=SC.PickerPane.create({layout:{width:500,height:300},contentView:Kiosque.SettingsView.extend({layout:{top:0,left:0,bottom:0,right:0}})});b.popup(a)},addNewFeed:function(d){var a=d.parentView.parentView;var c=a.getPath("newFeedSection.nameField.value");var b=a.getPath("newFeedSection.urlField.value");if(!SC.empty(c)&&!SC.empty(b)){SC.Logger.debug("add new feed %@, %@".fmt(c,b));var e=Kiosque.store.createRecord(Kiosque.RssSource,{name:c,url:b});e.commitRecord()}Kiosque.settingsViewController.hideNewFeedSection(a)},collectionViewDeleteContent:function(a,c,b){SC.AlertPane.warn({message:"The RSS source will be permanently removed.",description:"Do you wanna proceed?",caption:null,delegate:this,buttons:[{title:"Delete"},{title:"Cancel"},{title:null}],indexes:b})},deleteRecords:function(d){var c=d.map(function(e){var f=this.objectAt(e);return f},this);c.invoke("destroy").invoke("commitRecord");var b=d.get("min")-1;if(b<0){b=0}SC.Logger.debug("selIndex: %@".fmt(b));var a=this;this.invokeLater(function(){a.selectObject(this.objectAt(b))})},alertPaneDidDismiss:function(c,a){switch(a){case SC.BUTTON1_STATUS:var b=c.get("indexes");this.deleteRecords(b);break;case SC.BUTTON2_STATUS:break;case SC.BUTTON3_STATUS:break}}});Kiosque.thumbsController=SC.ArrayController.create({selection:null,nbPagesBinding:"Kiosque.mainPage.mainPane.grid.numberOfPages",gridSelectedPageBinding:"Kiosque.mainPage.mainPane.grid.currentTabIndex",gridSelectedPageDidChange:function(){var a=this.get("gridSelectedPage");this.selectObject(this.objectAt(a))}.observes("gridSelectedPage"),selectionDidChange:function(){var d=this.get("selection");var b=this.get("gridSelectedPage");if(d&&d.get("length")>0){var c=d.firstObject();var a=c.get("index");var e=Kiosque.getPath("mainPage.mainPane.grid");if(e&&(a!=b)){e.navigateToTab(a)}}}.observes("selection"),content:function(){var b=[],a=this.get("nbPages"),c,d;for(c=0;c<a;c++){d=SC.Object.create({name:""+(c+1),index:c});b.push(d)}return b}.property("nbPages")});Kiosque.tweetsController=SC.ArrayController.create({content:null,selection:null,selectedUrl:null,maxTweets:10,loadTweets:function(){var b,c=this.get("content"),a=this.get("selectedUrl");if(SC.none(a)){return}if(!SC.none(c)){}b=SC.Query.local(Kiosque.Tweet,{orderBy:"creationDate DESC",articleUrl:a,maxTweets:this.get("maxTweets"),conditions:"queryUrl = {selected}",parameters:{selected:a}});c=Kiosque.store.find(b);Kiosque.tweetsController.set("content",c)}.observes("selectedUrl")});Kiosque.FeedsDataSource=SC.DataSource.extend({fetchFeed:function(c,b,a){jQuery.ajax({url:document.location.protocol+"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=%@&q=%@".fmt(b,encodeURIComponent(c)),dataType:"jsonp",context:this,success:a})},fetch:function(c,f){var h=this;if(f.recordType==Kiosque.Feed){var g=f.get("feedUrls");var b=f.get("maxEntriesPerFeed");g.forEach(function(i){jQuery.ajax({url:document.location.protocol+"//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=%@&q=%@".fmt(b,encodeURIComponent(i)),dataType:"jsonp",context:h,success:function(j){SC.RunLoop.begin();h.didFetchFeed(j,i,c,f);SC.RunLoop.end()}})});return YES}else{if(f.recordType==Kiosque.RssSource){var a=Kiosque.preferencesController.get("feeds");c.loadRecords(Kiosque.RssSource,a);c.dataSourceDidFetchQuery(f);f.set("queryLoaded",YES);return YES}else{if(f.recordType==Kiosque.Tweet){var e=f.get("articleUrl");var d=f.get("maxTweets");jQuery.ajax({url:document.location.protocol+"//search.twitter.com/search.json?rpp=%@&q=%@".fmt(d,encodeURIComponent(e)),dataType:"jsonp",context:h,success:function(i){SC.RunLoop.begin();h.didFetchTweets(i,e,c,f);SC.RunLoop.end()}})}}}return NO},didFetchFeed:function(c,h,b,g){SC.Logger.debug("didFetchFeed %@".fmt(h));if(c.responseStatus==200){var f=c.responseData.feed;var a=f.entries;f.guid=f.feedUrl;delete f.entries;var e=a.getEach("link");f.articles=e;a.forEach(function(i){i.guid=i.link;i.feeds=[f.guid];i.source=h});b.loadRecords(Kiosque.Feed,[f]);b.loadRecords(Kiosque.Article,a)}if(!SC.none(g)){var d=g._fetchedFeeds;if(SC.none(d)){d=g._fetchedFeeds=[]}d.push(h);if(d.get("length")==g.getPath("feedUrls.length")){SC.Logger.debug("All feeds fetched");b.dataSourceDidFetchQuery(g);g.set("queryLoaded",YES)}}},didFetchTweets:function(b,e,a,d){SC.Logger.debug("didFetchTweets for %@".fmt(e));if("results" in b){var c=b.results;c.forEach(function(f){f.queryUrl=e});a.loadRecords(Kiosque.Tweet,c);a.dataSourceDidFetchQuery(d);d.set("queryLoaded",YES)}},retrieveRecord:function(a,b){return NO},createRecord:function(a,b){if(SC.kindOf(a.recordTypeFor(b),Kiosque.RssSource)){var c=a.readDataHash(b);Kiosque.preferencesController.addFeed(c);a.dataSourceDidComplete(b);this.fetchFeed(c.url,45,function(d){SC.RunLoop.begin();this.didFetchFeed(d,c.url,a);SC.RunLoop.end()});return YES}return NO},updateRecord:function(a,b){return NO},destroyRecord:function(a,b){if(SC.kindOf(a.recordTypeFor(b),Kiosque.RssSource)){var c=a.readDataHash(b);Kiosque.preferencesController.removeFeed(c);a.dataSourceDidDestroy(b);return YES}return NO}});Kiosque.FixturesDataSource=SC.FixturesDataSource.extend({simulateRemoteResponse:YES,latency:500});Kiosque.Article=SC.Record.extend({title:SC.Record.attr(String),author:SC.Record.attr(String),snippet:SC.Record.attr(String,{key:"contentSnippet"}),content:SC.Record.attr(String,{key:"content"}),publishedDate:SC.Record.attr(SC.DateTime,{format:"%a, %d %b %Y %H:%M:%S %Z"}),url:SC.Record.attr(String,{key:"link"}),feeds:SC.Record.toMany("Kiosque.Feed",{isMaster:NO,inverse:"articles"}),source:SC.Record.toOne("Kiosque.RssSource"),cover:function(){var a=this.get("content");var c=null;var b=a.match(/src="(.*?)"/);if(b&&b.get("length")>=2){c=b[1]}return c}.property("content").cacheable()});Kiosque.Feed=SC.Record.extend({title:SC.Record.attr(String),description:SC.Record.attr(String),updated:SC.Record.attr(SC.Datetime),articles:SC.Record.toMany("Kiosque.Article",{isMaster:YES,inverse:"feeds"}),feedUrl:SC.Record.attr(SC.String),link:SC.Record.attr(SC.String)});Kiosque.RssSource=SC.Record.extend({primaryKey:"url",name:SC.Record.attr(String),url:SC.Record.attr(String)});Kiosque.Tweet=SC.Record.extend({primaryKey:"id_str",user:SC.Record.attr(String,{key:"from_user"}),userId:SC.Record.attr(String,{key:"from_user_id_str"}),userImageUrl:SC.Record.attr(String,{key:"profile_image_url"}),creationDate:SC.Record.attr(SC.DateTime,{key:"created_at",format:"%a, %d %b %Y %H:%M:%S %Z"}),text:SC.Record.attr(String)});SC.BaseTheme.articleLabelRenderDelegate=SC.RenderDelegate.create({className:"label",render:function(d,c){this.addSizeClassName(d,c);var a=d.get("toolTip");if(a){c.attr("title",a)}c.addStyle({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});c.setClass("ellipsis",d.get("needsEllipsis")||NO);c.setClass("icon",d.get("icon")||NO);var b=this._htmlForTitleAndIcon(d);c.push(b);d.get("renderState")._lastHTMLForTitleAndIcon=b},update:function(d,a){this.updateSizeClassName(d,a);a.css({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});var b=d.get("toolTip");if(b){a.attr("title",b)}else{a.removeAttr("title")}a.setClass("ellipsis",d.get("needsEllipsis")||NO);var c=this._htmlForTitleAndIcon(d);if(d.get("renderState")._lastHTMLForTitleAndIcon!==c){a.html(c);d.get("renderState")._lastHTMLForTitleAndIcon=c}},_htmlForTitleAndIcon:function(a){var h=a.get("title"),c=a.get("hint"),j=a.get("escapeHTML"),g=a.get("icon")||"",d=a.get("articleTitle"),b=a.get("articleAuthor"),f=a.get("articleDate"),i=a.get("articleLink");if(!SC.none(f)){f=f.toTimezone(SC.DateTime.timezone);f=f.toFormattedString("%A, %b %d, %Y %i:%M %p")}var e='<div class="article-header"><a href="%@" target="_blank"><span class="title">%@</span></a><div class="byline"><span class="author">%@</span><span class="date">%@</span></div></div>'.fmt(i,d,b,f);if(h&&j){h=SC.RenderContext.escapeHTML(h)}if(c&&!h){if(j){c=SC.RenderContext.escapeHTML(c)}h="<span class='sc-hint'>"+c+"</span>"}if(g){if(g.indexOf("/")>=0){g='<img src="'+g+'" alt="" class="icon" />'}else{g='<img src="'+SC.BLANK_IMAGE_URL+'" alt="" class="icon '+g+'" />'}}return g+e+h}});SC.BaseTheme.centerImageRenderDelegate=SC.RenderDelegate.create({name:"image",render:function(f,c){var e=f.get("image"),b=f.get("imageValue"),d=SC.IMAGE_TYPE_URL,a=f.get("toolTip");c=c.begin("div");if(b&&d===SC.IMAGE_TYPE_CSS_CLASS){}if(a){c.attr("title",a);c.attr("alt",a)}c.addStyle(this.imageStyles(f));c=c.end()},update:function(e,a){var d=e.get("image"),c=e.get("imageValue"),b=e.get("toolTip");a=a.find("div");if(c){}if(b){a.attr("title",b);a.attr("alt",b)}a.css(this.imageStyles(e))},imageStyles:function(c){var b=c.get("innerFrame"),a=c.get("imageValue");return{position:"absolute",left:Math.round(b.x),top:Math.round(b.y),width:Math.round(b.width),height:Math.round(b.height),"background-image":"url(%@)".fmt(a),"background-position":"center top","background-size":"cover"}}});SC.BaseTheme.customCanvasImageRenderDelegate=SC.RenderDelegate.create({render:function(c,b){var a=this._htmlForContent(c);b.push(a);c.get("renderState")._lastHTML=a},update:function(v,e){var h=this._htmlForContent(v);if(v.get("renderState")._lastHTML!==h){e.html(h);v.get("renderState")._lastHTML=h}var w=e.find("canvas")[0],q=v.get("image"),m=v.get("frame"),t=m.width,f=m.height,n=v.get("innerFrame"),d=v.get("fillWithWhite")||YES,z=v.get("renderState"),b;var a=![n.x,n.y,n.width,n.height].isEqual(z._lastInnerFrameValues),x=v.didChangeFor("customCanvasImageRenderDelegate","backgroundColor"),i=v.didChangeFor("customCanvasImageRenderDelegate","image")||(q&&q.complete)!==z._lastImageComplete;if(a||x||i){if(w&&w.getContext){w.height=f;w.width=t;b=w.getContext("2d");b.clearRect(0,0,t,f);var p=0,o=0,r=q.width,y=q.height,k=Math.floor(n.x),g=Math.floor(n.y),l=Math.floor(n.width),u=Math.floor(n.height),c,j;if(r==1&&y==1){return}c=Math.min(r,l);j=c*y/(r*1);if(j>u){j=u;c=c*u/(y*1)}p=Math.floor((r-c)/2);o=Math.floor((y-j)/2);k=Math.floor((l-c)/2);g=Math.floor((u-j)/2);if(q&&q.complete){if(d){b.fillStyle="white";b.fillRect(0,0,t,f)}b.drawImage(q,0,0,r,y,k,g,c,j)}}z._lastInnerFrameValues=[n.x,n.y,n.width,n.height];z._lastImageComplete=q&&q.complete}},_htmlForContent:function(g){var c=g.get("content"),f=c.get("title"),e=c.getPath("source.name");var a,d,b;a='<div class="article-thumb-feed">%@</div>'.fmt(SC.RenderContext.escapeHTML(e));d='<div class="article-thumb-title">%@</div>'.fmt(SC.RenderContext.escapeHTML(f));b='<canvas class="article-thumb-cover"></canvas>';return a+d+b}});SC.BaseTheme.customTweetRenderDelegate=SC.RenderDelegate.create({className:"label",render:function(d,c){this.addSizeClassName(d,c);var a=d.get("toolTip");if(a){c.attr("title",a)}c.addStyle({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});c.setClass("ellipsis",d.get("needsEllipsis")||NO);c.setClass("icon",d.get("icon")||NO);var b=this._htmlForTitleAndIcon(d);c.push(b);d.get("renderState")._lastHTMLForTitleAndIcon=b},update:function(d,a){this.updateSizeClassName(d,a);a.css({fontWeight:d.get("fontWeight")||null,textAlign:d.get("textAlign")||null});var b=d.get("toolTip");if(b){a.attr("title",b)}else{a.removeAttr("title")}a.setClass("ellipsis",d.get("needsEllipsis")||NO);var c=this._htmlForTitleAndIcon(d);if(d.get("renderState")._lastHTMLForTitleAndIcon!==c){a.html(c);d.get("renderState")._lastHTMLForTitleAndIcon=c}},_htmlForTitleAndIcon:function(a){var i=a.get("title"),d=a.get("hint"),k=a.get("escapeHTML"),h=a.get("icon")||"",g=a.get("content"),j=g.get("text"),c=g.get("user"),b=g.get("creationDate"),f=g.get("userImageUrl");if(!SC.none(b)){b=b.toTimezone(SC.DateTime.timezone);b=b.toFormattedString("%Y/%m/%d %H:%M:%S")}var e='<div class="tweet-image"><img src="%@"/></div><div class="tweet-info"><span class="user">%@</span><span class="date">%@</span></div><div class="tweet-text">%@</div>'.fmt(f,c,b,j);return e}});SC.TEMPLATES.kiosque=SC.Handlebars.compile("<h1>Welcome to SproutCore!</h1>\n");function Matrix(){}var Sylvester={version:"0.1.3",precision:0.000001};Matrix.prototype={e:function(d,c){return d<1||d>this.elements.length||c<1||c>this.elements[0].length?null:this.elements[d-1][c-1]},map:function(j){var i=[],p=this.elements.length,o=p,n,m,l=this.elements[0].length,k;do{n=o-p,m=l,i[n]=[];do{k=l-m,i[n][k]=j(this.elements[n][k],n+1,k+1)}while(--m)}while(--p);return Matrix.create(i)},multiply:function(C){if(!C.elements){return this.map(function(a){return a*C})}var B=C.modulus?!0:!1,A=C.elements||C;typeof A[0][0]=="undefined"&&(A=Matrix.create(A).elements);if(!this.canMultiplyFromLeft(A)){return null}var z=this.elements.length,y=z,x,w,v=A[0].length,u,t=this.elements[0].length,r=[],q,p,o;do{x=y-z,r[x]=[],w=v;do{u=v-w,q=0,p=t;do{o=t-p,q+=this.elements[x][o]*A[o][u]}while(--p);r[x][u]=q}while(--w)}while(--z);var A=Matrix.create(r);return B?A.col(1):A},x:function(b){return this.multiply(b)},canMultiplyFromLeft:function(d){var c=d.elements||d;return typeof c[0][0]=="undefined"&&(c=Matrix.create(c).elements),this.elements[0].length==c.length},setElements:function(u){var t,r=u.elements||u;if(typeof r[0][0]!="undefined"){var q=r.length,p=q,o,n,m;this.elements=[];do{t=p-q,o=r[t].length,n=o,this.elements[t]=[];do{m=n-o,this.elements[t][m]=r[t][m]}while(--o)}while(--q);return this}var l=r.length,k=l;this.elements=[];do{t=k-l,this.elements.push([r[t]])}while(--l);return this}},Matrix.create=function(d){var c=new Matrix;return c.setElements(d)},$M=Matrix.create,function(G){if(!G.cssHooks){throw"jQuery 1.4.3+ is needed for this plugin to work"}var F="transform",E,D,C,B,A,z=F.charAt(0).toUpperCase()+F.slice(1),y=["Moz","Webkit","O","MS"],x=document.createElement("div");if(F in x.style){D=F,C=x.style.perspective!==undefined}else{for(var w=0;w<y.length;w++){E=y[w]+z;if(E in x.style){D=E,y[w]+"Perspective" in x.style?C=!0:B=!0;break}}}D||(A="filter" in x.style,D="filter"),x=null,G.support[F]=D;var v=D,u={rotateX:{defaultValue:0,matrix:function(b){return C?$M([[1,0,0,0],[0,Math.cos(b),Math.sin(-b),0],[0,Math.sin(b),Math.cos(b),0],[0,0,0,1]]):$M([[1,0,0],[0,1,0],[0,0,1]])}},rotateY:{defaultValue:0,matrix:function(b){return C?$M([[Math.cos(b),0,Math.sin(b),0],[0,1,0,0],[Math.sin(-b),0,Math.cos(b),0],[0,0,0,1]]):$M([[1,0,0],[0,1,0],[0,0,1]])}},rotateZ:{defaultValue:0,matrix:function(b){return C?$M([[Math.cos(b),Math.sin(-b),0,0],[Math.sin(b),Math.cos(b),0,0],[0,0,1,0],[0,0,0,1]]):$M([[Math.cos(b),Math.sin(-b),0],[Math.sin(b),Math.cos(b),0],[0,0,1]])}},scale:{defaultValue:1,matrix:function(b){return C?$M([[b,0,0,0],[0,b,0,0],[0,0,b,0],[0,0,0,1]]):$M([[b,0,0],[0,b,0],[0,0,1]])}},translateX:{defaultValue:0,matrix:function(b){return C?$M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[b,0,0,1]]):$M([[1,0,0],[0,1,0],[b,0,1]])}},translateY:{defaultValue:0,matrix:function(b){return C?$M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,b,0,1]]):$M([[1,0,0],[0,1,0],[0,b,1]])}},translateZ:{defaultValue:0,matrix:function(b){return C?$M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,b,1]]):$M([[1,0,0],[0,1,0],[0,0,1]])}}},t=function(a){var g=G(a).data("transforms"),f;C?f=$M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]):f=$M([[1,0,0],[0,1,0],[0,0,1]]);for(var e in u){f=f.x(u[e].matrix(g[e]||u[e].defaultValue))}C?(s="matrix3d(",s+=f.e(1,1).toFixed(10)+","+f.e(1,2).toFixed(10)+","+f.e(1,3).toFixed(10)+","+f.e(1,4).toFixed(10)+",",s+=f.e(2,1).toFixed(10)+","+f.e(2,2).toFixed(10)+","+f.e(2,3).toFixed(10)+","+f.e(2,4).toFixed(10)+",",s+=f.e(3,1).toFixed(10)+","+f.e(3,2).toFixed(10)+","+f.e(3,3).toFixed(10)+","+f.e(3,4).toFixed(10)+",",s+=f.e(4,1).toFixed(10)+","+f.e(4,2).toFixed(10)+","+f.e(4,3).toFixed(10)+","+f.e(4,4).toFixed(10),s+=")"):B?(s="matrix(",s+=f.e(1,1).toFixed(10)+","+f.e(1,2).toFixed(10)+",",s+=f.e(2,1).toFixed(10)+","+f.e(2,2).toFixed(10)+",",s+=f.e(3,1).toFixed(10)+"px,"+f.e(3,2).toFixed(10)+"px",s+=")"):A&&(s="progid:DXImageTransform.Microsoft.",s+="Matrix(",s+="M11="+f.e(1,1).toFixed(10)+",",s+="M12="+f.e(1,2).toFixed(10)+",",s+="M21="+f.e(2,1).toFixed(10)+",",s+="M22="+f.e(2,2).toFixed(10)+",",s+="SizingMethod='auto expand'",s+=")",a.style.top=f.e(3,1),a.style.left=f.e(3,2)),a.style[v]=s},r=function(a){return G.fx.step[a]=function(b){G.cssHooks[a].set(b.elem,b.now+b.unit)},{get:function(i,h,g){var b=G(i).data("transforms");return b===undefined&&(b={},G(i).data("transforms",b)),b[a]||u[a].defaultValue},set:function(i,h){var g=G(i).data("transforms");g===undefined&&(g={});var b=u[a];typeof b.apply=="function"?g[a]=b.apply(g[a]||b.defaultValue,h):g[a]=h,G(i).data("transforms",g),t(i)}}};if(v){for(var q in u){G.cssHooks[q]=r(q),G.cssNumber[q]=!0}}}(jQuery);Kiosque.statechart=SC.Statechart.create({initialState:"feeds",feeds:SC.State.extend({enterState:function(){if(!this._dataLoaded){Kiosque.sourcesController.loadSources();this.invokeLast("initData");this._dataLoaded=YES}},initData:function(){this.showSpinner();Kiosque.feedsController.loadFeeds();Kiosque.articlesController.loadArticles()},exitState:function(){},openArticle:function(a){if(SC.none(a)){return}Kiosque.articleController.set("content",a);this.gotoState("articles")},filterSource:function(a){if(!SC.none(a)){Kiosque.articlesController.loadArticlesFromSource(a)}},showSpinner:function(){var a=this.get("loadingPane");if(a&&a.get("isPaneAttached")){return}if(SC.none(a)){a=SC.PalettePane.create({classNames:"spinner-panel".w(),layout:{width:70,height:70,centerX:0,centerY:0},contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0},childViews:"imageView".w(),imageView:SC.ImageView.design({layout:{centerX:0,centerY:0,width:24,height:24},value:"/static/kiosque/en/c56fe5edb96f21f0cc1fc56aae0feae63a5ea557/source/resources/images/spinner-black.gif",useCanvas:NO})})})}a.append();this.setIfChanged("loadingPane",a)},hideSpinner:function(){var a=this.get("loadingPane");if(a&&a.get("isPaneAttached")){a.remove()}}}),articles:SC.State.extend({enterState:function(){var a=Kiosque.getPath("mainPage.mainPane.article");a.set("content",Kiosque.articleController.get("content"));var b=a.$();if(a.get("isVisible")===NO){a.set("isVisible",YES)}b.addClass("article-visible");this.set("view",a)},exitState:function(){var a=this.get("view");var b=a.$();b.removeClass("article-visible")},close:function(){this.gotoState("feeds")},tweets:function(){SC.Logger.debug("tweets");var a=this.get("view");var d=a.get("tweetsView");if(d.get("isVisible")===NO){d.set("isVisible",YES)}var c=Kiosque.articleController.getPath("content.url");Kiosque.tweetsController.set("selectedUrl",c);var b=d.$();b.addClass("tweets-visible")},closeTweets:function(){var a=this.get("view");var c=a.get("tweetsView");var b=c.$();b.removeClass("tweets-visible")}})});Kiosque.ArrayPage=SC.Object.extend(SC.Array,{masterArray:null,itemsPerPage:null,pageIndex:null,length:function(){var c=this.get("itemsPerPage"),b=this.get("pageIndex");if(b<0||c<0){throw"pageIndex and itemsPerPage must be a positive integer"}var e=this.getPath("masterArray.length"),a=Math.max(Math.ceil(e*1/c),1);if(b<(a-1)){return c}else{if(b===(a-1)){var d=b*c;return(e-d)}else{return 0}}}.property("itemsPerPage","pageIndex","*masterArray.length"),objectAt:function(b){var d=this.get("itemsPerPage"),a=this.get("pageIndex"),c=this.get("masterArray"),f=a*d+b,e=this.get("length");if(SC.none(this.masterArray)){throw"ArrayPage : masterArray is null."}if(a<0||d<0){throw"ArrayPage: pageIndex and itemsPerPage must be a positive integer"}if(b>=e){return null}return c.objectAt(f)},replace:function(c,h,f){if(SC.none(this.masterArray)){throw"ArrayPage : masterArray is null."}var e=this.get("itemsPerPage"),b=this.get("pageIndex"),d=this.get("masterArray"),g=b*e+c;var a=f?f.get("length"):0;this.arrayContentWillChange(c,h,a);this.beginPropertyChanges();this.masterArray.replace(g,h,f);this.enumerableContentDidChange(c,h,a-h);this.endPropertyChanges();this.arrayContentDidChange(c,h,a)},_masterDidChange:function(){this.allPropertiesDidChange()}.observes("*masterArray.[]"),toString:function(){return"index %@".fmt(this.get("pageIndex"))}});Kiosque.Theme=SC.AceTheme.create({name:"kiosque"});SC.Theme.addTheme(Kiosque.Theme);SC.defaultTheme="kiosque";Kiosque.ArticleThumbnailView=SC.ImageView.extend({classNames:"article-thumb".w(),displayProperties:["content"],renderDelegateName:"customCanvasImageRenderDelegate",tagName:"div"});Kiosque.ImageButtonView=SC.ImageView.extend({action:null,target:null,isActive:NO,isEnabled:YES,init:function(){arguments.callee.base.apply(this,arguments);this.isEnabledChange()},render:function(a,b){arguments.callee.base.apply(this,arguments);if(this.get("isActive")){a.addClass("button-active")}else{a.removeClass("button-active")}if(!this.get("isEnabled")){a.addClass("button-disabled")}else{a.removeClass("button-disabled")}},isActiveChange:function(){this.set("layerNeedsUpdate",YES)}.observes("isActive"),isEnabledChange:function(){this.set("layerNeedsUpdate",YES)}.observes("isEnabled"),mouseDown:function(a){this.touchStart(a)},mouseUp:function(a){this.touchEnd(a)},touchStart:function(a){this.set("isActive",YES);return YES},touchEnd:function(a){this.set("isActive",NO);if(this.get("isEnabled")){this._runAction()}},_runAction:function(){var a=this.get("action"),b=this.get("target")||null;if(SC.typeOf(a)==SC.T_FUNCTION){a.call(b)}else{if(a){this.getPath("pane.rootResponder").sendAction(a,b,this,this.get("pane"),null,this)}}}});require("views/image_button");Kiosque.ArticleView=SC.View.extend({classNames:"article-container".w(),childViews:"header scroll closeButton footer tweetsView".w(),content:null,header:SC.View.design({layout:{top:0,right:10,left:10,height:75},classNames:"article-top".w(),childViews:"title".w(),title:SC.LabelView.design({layout:{centerX:0,centerY:0,height:50,width:300},value:"Kiosque",tagName:"h1"})}),footer:SC.View.design({layout:{bottom:0,right:0,left:0,height:75},classNames:"article-footer".w(),childViews:"tweetsButton".w(),tweetsButton:Kiosque.ImageButtonView.design({layout:{right:21,centerY:0,height:40,width:40},value:"/static/kiosque/en/c56fe5edb96f21f0cc1fc56aae0feae63a5ea557/source/resources/images/twitter.png",action:function(){Kiosque.statechart.sendEvent("tweets")}})}),scroll:SC.LabelView.design({classNames:"article-content".w(),layout:{top:96,left:21,right:21,bottom:96},valueBinding:"*content.content",escapeHTML:NO,contentBinding:"*parentView.content",articleTitleBinding:"*content.title",articleAuthorBinding:"*content.author",articleDateBinding:"*content.publishedDate",articleLinkBinding:"*content.url",displayProperties:["articleTitle","articleAuthor","articleDate","articleLink"],renderDelegateName:"articleLabelRenderDelegate",shouldAutoResize:NO,widthDidChange:function(){var a=this.get("measuredSize");SC.Logger.debug("width: %@".fmt(a.width))}.observes("measuredSize")}),closeButton:Kiosque.ImageButtonView.design({layout:{left:0,top:0,height:75,width:75},value:"/static/kiosque/en/c56fe5edb96f21f0cc1fc56aae0feae63a5ea557/source/resources/images/back.png",action:function(){Kiosque.statechart.sendEvent("close")}}),tweetsView:SC.View.design({layout:{right:0,bottom:0,left:0,top:0},isVisible:YES,classNames:"article-tweets".w(),childViews:"wrapper".w(),mouseDown:function(){return YES},mouseUp:function(){Kiosque.statechart.sendEvent("closeTweets")},touchStart:function(){return this.mouseDown()},touchEnd:function(){return this.mouseUp()},wrapper:SC.View.design({layout:{left:0,right:0,height:400,bottom:0},classNames:"article-tweets-wrapper".w(),childViews:"headerView tweetsContainer".w(),headerView:SC.View.design({layout:{top:0,right:0,left:0,height:65},classNames:"article-tweets-header".w(),childViews:"titleView closeButton".w(),titleView:SC.LabelView.design({layout:{left:21,centerY:0,height:21,right:60},classNames:"article-tweets-title".w(),value:"Reactions"}),closeButton:Kiosque.ImageButtonView.design({layout:{right:21,centerY:0,height:40,width:40},value:"/static/kiosque/en/c56fe5edb96f21f0cc1fc56aae0feae63a5ea557/source/resources/images/twitter.png",action:function(){Kiosque.statechart.sendEvent("closeTweets")}})}),tweetsContainer:SC.ScrollView.design({layout:{left:0,right:0,top:65,bottom:0},canScrollVertical:YES,hasVerticalScroller:NO,hasHorizontalScroller:NO,alwaysBounceHorizontal:NO,alwaysBounceVertical:YES,contentView:SC.ListView.design({layout:{top:0,right:0,bottom:0,left:0},classNames:"article-tweets-list".w(),contentBinding:"Kiosque.tweetsController.arrangedObjects",selectionBinding:"Kiosque.tweetsController.selection",rowHeight:70,exampleView:SC.LabelView.design({classNames:"tweet".w(),displayProperties:["content"],renderDelegateName:"customTweetRenderDelegate"})})})})})});require("views/article_thumbnail_view");Kiosque.ArticlesPageView=SC.GridView.extend({classNames:"articles-grid-page".w(),articlesGrid:null,layout:{top:0,left:0,right:0,bottom:0},content:null,contentValueKeyBinding:"*articlesGrid.contentValueKey",contentIconKey:"*articlesGrid.contentIconKey",selectionBinding:"*articlesGrid.selection",actionBinding:"*articlesGrid.action",targetBinding:"*articlesGrid.target",columnWidthBinding:"*articlesGrid.columnWidth",rowHeightBinding:"*articlesGrid.rowHeight",itemsSpacingBinding:"*articlesGrid.itemsSpacing",orientationBinding:"*articlesGrid.orientation",exampleView:Kiosque.ArticleThumbnailView.design(),canEditContent:NO,canDeleteContent:NO,itemsPerRow:function(){var a=this.get("orientation");if(a==SC.HORIZONTAL_ORIENTATION){return 5}else{return 3}}.property("orientation").cacheable(),layoutForContentIndex:function(h){var d=this.get("rowHeight")||48,a=this.get("clippingFrame").width,b=this.get("itemsPerRow"),e=this.get("columnWidth")||48,g=this.get("itemsSpacing")||10,f=Math.floor(h/b),c=h-(b*f);return{left:c*(e+g),top:f*(d+g),height:d,width:e}},_gv_clippingFrameDidChange:function(){}.observes("clippingFrame"),computeLayout:function(){var e=this.get("content"),d=(e)?e.get("length"):0,c=this.get("rowHeight")||48,g=this.get("columnWidth")||48,a=this.get("itemsPerRow"),f=Math.ceil(d/a);var b=this._cachedLayoutHash;if(!b){b=this._cachedLayoutHash={}}b.minHeight=f*c;this.calculatedHeight=b.minHeight;b.minWidth=a*g;this.calculatedWidth=b.minWidth;return b},toString:function(){return"page %@".fmt(this.get("content"))}});require("system/array_page");require("views/articles_page_view");Kiosque.ArticlesGridView=Iweb.TabControlView.extend({content:null,contentValueKey:null,contentIconKey:null,selection:null,action:null,target:null,numberOfPages:0,init:function(){arguments.callee.base.apply(this,arguments)},classNames:"articles-grid".w(),_pagesPool:[],_pages:[],itemsSpacing:10,pageExampleView:Kiosque.ArticlesPageView,isTabBarVisible:NO,flickingThreshold:0.3,orientation:function(){var a=this.get("frame");if(a.width>a.height){return SC.HORIZONTAL_ORIENTATION}else{return SC.VERTICAL_ORIENTATION}}.property("frame").cacheable(),columnWidth:function(){var e=this.get("frame"),d=this.get("itemsSpacing"),b=this.get("orientation");var a=b===SC.HORIZONTAL_ORIENTATION?5:3;var c=(e.width-(d*(a-1)))/a;return c}.property("orientation").cacheable(),rowHeight:function(){var e=this.get("frame"),d=this.get("itemsSpacing"),a=this.get("orientation");var c=a===SC.HORIZONTAL_ORIENTATION?2:3;var b=(e.height-(d*(c-1)))/c;return b}.property("orientation").cacheable(),_contentDidChange:function(){}.observes("content"),itemsPerPage:function(){var a=this.get("orientation");if(a==SC.HORIZONTAL_ORIENTATION){return 10}else{return 9}}.property("orientation").cacheable(),_computePages:function(){var d=this.get("itemsPerPage"),h=this.getPath("content.length"),c=Math.max(Math.ceil(h*1/d),1),g=this._pages.get("length"),e=this.get("content"),a=this.get("pageExampleView");var f,b;if(c>g){for(b=g;b<c;b++){f=this._pagesPool.pop();if(SC.none(f)){f=a.design({pageIndex:b,articlesGrid:this,content:Kiosque.ArrayPage.create({masterArray:e,itemsPerPage:d,pageIndex:b})})}else{f.set("pageIndex",b);f.set("articlesGrid",this);f.set("content",Kiosque.ArrayPage.create({masterArray:e,itemsPerPage:d,pageIndex:b}))}f=this.addTab(f);this._pages.push(f)}}else{if(c<g){for(b=c;b<g;b++){f=this._pages.pop();this.removeTab(f);f.set("content",null);f.set("pageIndex",null);f.set("articlesGrid",null);this._pagesPool.push(f)}}}this._updatePagesContent();this.navigateToTab(0);this.set("numberOfPages",this._pages.get("length"))}.observes("*content.length","itemsPerPage"),_updatePagesContent:function(){var c=this.get("itemsPerPage"),g=this.getPath("content.length"),f=this._pages.get("length"),d=this.get("content");var b,e,a;for(b=0;b<f;b++){e=this._pages[b];a=Kiosque.ArrayPage.create({masterArray:d,itemsPerPage:c,pageIndex:b});e.set("content",a)}}});Kiosque.SettingsView=SC.View.extend({classNames:"settings-panel".w(),childViews:"feedsLabel scroll newFeedSection buttonsSection".w(),feedsLabel:SC.LabelView.design({layout:{top:10,left:10,height:24,width:200},value:"Feeds"}),scroll:SC.ScrollView.design({classNames:"feeds".w(),layout:{top:35,right:10,left:10,height:150},contentView:SC.GridView.design({layout:{top:0,right:0,bottom:0,left:0},contentBinding:"Kiosque.sourcesController",contentValueKey:"name",columnWidth:240,rowHeight:25,canEditContent:YES,canDeleteContent:YES,exampleView:SC.LabelView.design({classNames:"feed-label".w()})})}),newFeedSection:SC.View.design({isVisible:NO,layout:{top:200,left:0,bottom:0,right:0},childViews:"nameLabel urlLabel nameField urlField addButton".w(),nameLabel:SC.LabelView.design({layout:{top:0,left:10,height:20,width:180},value:"Name:"}),urlLabel:SC.LabelView.design({layout:{top:0,left:200,height:20,width:200},value:"Url:"}),nameField:SC.TextFieldView.design({layout:{top:20,left:10,height:25,width:180},hint:"Name...",isPassword:NO,isTextArea:NO}),urlField:SC.TextFieldView.design({layout:{top:20,left:200,height:25,right:10},hint:"Url...",isPassword:NO,isTextArea:NO}),addButton:SC.ButtonView.design({layout:{bottom:10,right:10,height:24,width:100},title:"Add Feed",action:"addNewFeed",target:"Kiosque.sourcesController"})}),buttonsSection:SC.View.design({layout:{top:200,left:0,bottom:0,right:0},childViews:"newFeedButton deleteButton".w(),newFeedButton:SC.ButtonView.design({layout:{top:10,left:145,height:30,width:100},title:"New Feed",action:"showNewFeedSection",target:"Kiosque.settingsViewController",controlSize:SC.HUGE_CONTROL_SIZE}),deleteButton:SC.ButtonView.design({layout:{top:10,left:255,height:30,width:100},title:"Delete Feed",action:"deleteFeed",target:"Kiosque.settingsViewController",controlSize:SC.HUGE_CONTROL_SIZE})})});require("views/articles_grid_view");require("views/article_view");require("views/image_button");Kiosque.mainPage=SC.Page.design({mainPane:SC.MainPane.design({childViews:"header grid footer article".w(),header:SC.View.design({layout:{top:0,right:0,left:0,height:120},classNames:"header".w(),childViews:"title feeds".w(),title:SC.LabelView.design({layout:{left:48,centerY:0,height:75,width:250},value:"Kiosque",tagName:"h1"}),feeds:SC.GridView.design({classNames:"feeds-view".w(),layout:{left:300,centerY:0,right:48,height:100},maxWidth:1024,contentValueKey:"name",contentBinding:"Kiosque.sourcesController.arrangedObjects",selectionBinding:"Kiosque.sourcesController.selection",columnWidth:150,rowHeight:50,canEditContent:NO,canDeleteContent:NO,exampleView:SC.LabelView.design({classNames:"feed-title".w()})})}),grid:Kiosque.ArticlesGridView.design({layout:{top:120,bottom:100,left:48,right:48},contentBinding:"Kiosque.articlesController.content",contentValueKey:"cover",selectionBinding:"Kiosque.articlesController.selection"}),footer:SC.View.design({layout:{bottom:0,right:0,left:0,height:75},classNames:"article-footer".w(),childViews:"feedsButton carrousel".w(),feedsButton:Kiosque.ImageButtonView.design({layout:{bottom:37,left:48,height:24,width:24},value:"/static/kiosque/en/c56fe5edb96f21f0cc1fc56aae0feae63a5ea557/source/resources/images/settings.png",action:"showPickerPane",target:"Kiosque.sourcesController"}),carrousel:Iweb.CarrouselView.design({classNames:"carrousel-view".w(),layout:{bottom:32,centerX:0,width:250,height:35},maxWidth:600,contentValueKey:"name",contentBinding:"Kiosque.thumbsController.arrangedObjects",selectionBinding:"Kiosque.thumbsController.selection",columnWidth:45,rowHeight:30,exampleView:SC.LabelView.design({classNames:"carrousel-label".w()})})}),article:Kiosque.ArticleView.design({isVisible:YES})})});